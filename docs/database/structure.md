---
id: structure
title: Estrutura do Banco de Dados
---

## Tabelas Principais

### Tabela de Cidades (`cities`)
- **id**: Identificador único (int)
- **name**: Nome da cidade (varchar)
- **state**: Estado (varchar)
- **region**: Região (varchar)
- **lat**: Latitude (float)
- **lng**: Longitude (float)

### Tabela de Empresas (`companies`)
- **id**: Identificador único (uuid)
- **cnpj**: CNPJ da empresa (varchar)
- **name**: Nome da empresa (varchar)
- **city_id**: Referência à cidade (int, chave estrangeira)
- **logo**: URL do logo (text)
- **sidebar_logo**: URL do logo da barra lateral (text)
- **sidebar_logo_mini**: URL do logo mini da barra lateral (text)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Perfis (`profiles`)
- **id**: Identificador único (uuid)
- **name**: Nome do perfil (varchar)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Menus (`menus`)
- **id**: Identificador único (uuid)
- **parent_id**: Referência ao menu pai (uuid)
- **title**: Título do menu (varchar)
- **icon**: Ícone do menu (varchar)
- **route**: Rota do menu (varchar)
- **profiles**: Lista de IDs de perfis que têm acesso (int[])
- **order**: Ordem do menu (int)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Usuários (`users`)
- **id**: Identificador único (uuid)
- **name**: Nome do usuário (varchar)
- **email**: Email do usuário (varchar)
- **password**: Senha do usuário (varchar)
- **profile_id**: Referência ao perfil (uuid)
- **reset_password_fields**: Campos para redefinição de senha (text)
- **active**: Indicador se o usuário está ativo (boolean)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Bancos (`banks`)
- **id**: Identificador único (uuid)
- **name**: Nome do banco (varchar)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Categorias de Pessoas (`people_categories`)
- **id**: Identificador único (uuid)
- **name**: Nome da categoria (varchar)
- **registration_type**: Tipo de registro (varchar)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Pessoas (`people`)
- **id**: Identificador único (uuid)
- **registration_type**: Tipo de registro (varchar)
- **name**: Nome da pessoa (varchar)
- **person_type**: Tipo de pessoa (varchar)
- **category_person_id**: Referência à categoria de pessoa (uuid)
- **cpf_cnpj**: CPF ou CNPJ (varchar)
- **rg_ie**: RG ou Inscrição Estadual (varchar)
- **date_of_birth**: Data de nascimento (date)
- **email**: Email (varchar)
- **phone1**: Telefone 1 (varchar)
- **phone2**: Telefone 2 (varchar)
- **zip_code**: CEP (varchar)
- **address**: Endereço (varchar)
- **number**: Número (varchar)
- **complement**: Complemento (varchar)
- **district**: Bairro (varchar)
- **city_id**: Referência à cidade (int, chave estrangeira)
- **lat**: Latitude (float)
- **lng**: Longitude (float)
- **notes**: Notas (text)
- **active**: Indicador se a pessoa está ativa (boolean)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Planos (`plans`)
- **id**: Identificador único (uuid)
- **name**: Nome do plano (varchar)
- **description**: Descrição do plano (text)
- **price**: Preço (numeric)
- **days_to_start_billing**: Dias para início da cobrança (int)
- **radius_group**: Grupo de raio (varchar)
- **active**: Indicador se o plano está ativo (boolean)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Categorias Financeiras (`financial_categories`)
- **id**: Identificador único (uuid)
- **parent_id**: Referência à categoria pai (uuid)
- **type**: Tipo (varchar)
- **name**: Nome da categoria (varchar)
- **active**: Indicador se a categoria está ativa (boolean)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Contas Financeiras (`financial_accounts`)
- **id**: Identificador único (uuid)
- **name**: Nome da conta (varchar)
- **type**: Tipo (varchar)
- **bank_id**: Referência ao banco (uuid)
- **agency**: Agência (varchar)
- **account**: Conta (varchar)
- **notes**: Notas (text)
- **active**: Indicador se a conta está ativa (boolean)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Métodos de Pagamento (`payment_methods`)
- **id**: Identificador único (uuid)
- **name**: Nome do método de pagamento (varchar)
- **active**: Indicador se o método de pagamento está ativo (boolean)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Status de Contratos (`contract_statuses`)
- **id**: Identificador único (uuid)
- **name**: Nome do status (varchar)
- **color**: Cor do status (varchar)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Contratos (`contracts`)
- **id**: Identificador único (uuid)
- **number**: Número do contrato (varchar)
- **person**: Referência à pessoa (uuid)
- **plan**: Referência ao plano (uuid)
- **price**: Preço (numeric)
- **start_date**: Data de início (date)
- **end_date**: Data de término (date)
- **billing_day**: Dia de cobrança (int)
- **username**: Nome de usuário (varchar)
- **password**: Senha (varchar)
- **installation_address**: Endereço de instalação (jsonb)
- **status_id**: Referência ao status do contrato (uuid)
- **cancellation_date**: Data de cancelamento (date)
- **cancellation_reason**: Motivo do cancelamento (text)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Logs de Contratos (`contract_logs`)
- **id**: Identificador único (uuid)
- **contract_id**: Referência ao contrato (uuid)
- **status_id**: Referência ao status (uuid)
- **comments**: Comentários (text)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela de Agendamentos Financeiros (`financial_schedule`)
- **id**: Identificador único (uuid)
- **frequency**: Frequência (varchar)
- **interval**: Intervalo (int)
- **quantity**: Quantidade (int)
- **first_date**: Primeira data (date)
- **value**: Valor (numeric)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

### Tabela Financeira (`financial`)
- **id**: Identificador único (uuid)
- **type**: Tipo (varchar)
- **financial_account**: Referência à conta financeira (uuid)
- **category**: Referência à categoria financeira (uuid)
- **schedule**: Referência ao agendamento financeiro (uuid)
- **number**: Número (varchar)
- **value**: Valor (numeric)
- **due_date**: Data de vencimento (date)
- **description**: Descrição (text)
- **person**: Referência à pessoa (uuid)
- **notes**: Notas (text)
- **payment_method**: Referência ao método de pagamento (uuid)
- **payment_date**: Data de pagamento (date)
- **paid_value**: Valor pago (numeric)
- **installment**: Parcela (int)
- **status**: Status (int)
- **created_at**: Data de criação (timestamp)
- **updated_at**: Data de atualização (timestamp)
- **deleted_at**: Data de exclusão (timestamp)
- **deleted_by**: ID do usuário que excluiu (int)

## Relacionamentos

### Principais Relacionamentos

- **cities** e **companies**: Um `company` tem uma `city` (relação um-para-muitos).
- **companies** e **people**: Uma `people` tem uma `company` (relação um-para-muitos).
- **profiles** e **users**: Um `user`tem um `profile` (relação um-para-muitos).
- **people_categories** e **people**: Uma `people` tem uma `category_people` (relação um-para-muitos).
- **plans** e **contracts**: Um `contract` tem um `plan` (relação um-para-muitos).
- **contract_statuses** e **contracts**: Um `contract` tem um `contract_statuses` (relação um-para-muitos).
- **contracts** e **contract_logs**: Um `contract_log` tem um `contract` (relação um-para-muitos).
- **financial_accounts** e **financial**: Um `financial` tem uma `financial_account` (relação um-para-muitos).
- **financial_categories** e **financial**: Um `financial` tem uma `financial_category` (relação um-para-muitos).

## Índices e Chaves

- **Índices**: Índices são criados para os campos frequentemente usados em consultas para melhorar a performance.
- **Chaves Primárias**: Garantem a unicidade dos registros nas tabelas.
- **Chaves Estrangeiras**: Mantêm a integridade referencial entre tabelas relacionadas.